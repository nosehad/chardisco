---
---

const practice_fonts = {
    PlaywriteDEGrund: {
        file: "/assets/fonts/practice_fonts/PlaywriteDEGrund - ExtraLight.ttf",
        name: "PlaywriteDEGrund",
        font_size: 22,
        line_height: 22,
        line_height_correction: -8.35, /* the higher this negative value, the upper the letters appear on the pdf */
        center_line_top_margin: 9
    },
    Charmonman: {
        file: "/assets/fonts/practice_fonts/Charmonman - Regular.ttf",
        name: "Charmonman",
        font_size: 19.5,
        line_height: 32.5,
        line_height_correction: -12,
        center_line_top_margin: 11.5
    },
    MrsSaintDelafield: {
        file: "/assets/fonts/practice_fonts/MrsSaintDelafield - Regular.ttf",
        name: "MrsSaintDelafield",
        font_size: 29,
        line_height: 34,
        line_height_correction: -14,
        center_line_top_margin: 14
    },
    DeliusSwashCaps: {
        file: "/assets/fonts/practice_fonts/DeliusSwashCaps - Regular.ttf",
        name: "DeliusSwashCaps",
        font_size: 27,
        line_height: 22,
        line_height_correction: -2,
        center_line_top_margin: 6.5
    },
    MeaCulpa: {
        file: "/assets/fonts/practice_fonts/MeaCulpa - Regular.ttf",
        name: "MeaCulpa",
        line_height: 22,
        line_height_correction: -6,
        font_size: 30,
        center_line_top_margin: 10
    },
    PlaywriteDEVA: {
        file: "/assets/fonts/practice_fonts/PlaywriteDEVA - Light.ttf",
        name: "PlaywriteDEVA",
        font_size: 21,
        line_height: 24,
        line_height_correction: -10,
        center_line_top_margin: 10
    },
    GreatVibes: {
        file: "/assets/fonts/practice_fonts/GreatVibes - Regular.ttf",
        name: "GreatVibes",
        font_size: 25,
        line_height: 31,
        line_height_correction: -3,
        center_line_top_margin: 11.5
    },
    PlaywriteCU: {
        file: "/assets/fonts/practice_fonts/PlaywriteCU - Light.ttf",
        name: "PlaywriteCU",
        font_size: 18,
        line_height: 25,
        line_height_correction: -13,
        center_line_top_margin: 11
    },
    Sacramento: {
        file: "/assets/fonts/practice_fonts/Sacramento - Regular.ttf",
        name: "Sacramento",
        font_size: 29,
        line_height: 31,
        line_height_correction: -10,
        center_line_top_margin: 13
    }
}

const letters = "Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz Ää Öö Üü <br> Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz Ää Öö Üü <br> Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz Ää Öö Üü"
const numbers = "1 2 3 4 5 6 7 8 9 0 * + - / 5% 10% 15% 25% 33% 40% 50% 70% 75% 80% 90% 100% <br> 1 2 3 4 5 6 7 8 9 0 * + - / 5% 10% 15% 25% 33% 40% 50% 70% 75% 80% 90% 100% <br> 1 2 3 4 5 6 7 8 9 0 * + - / 5% 10% 15% 25% 33% 40% 50% 70% 75% 80% 90% 100% <br> 1 2 3 4 5 6 7 8 9 0 * + - / 5% 10% 15% 25% 33% 40% 50% 70% 75% 80% 90% 100%"

const defLineHeight = 21.215; /* the default height of the sheet line background */
const defLineAmount = 24;
const defMaxTextWidth = 566;
const defSheetWidth = 600;
const defSheetHeight = 848;
const defLineBorderWidth = 2;
let defMaxPages = 3; /* chrome: 25 */

if (navigator.userAgent.indexOf('Firefox') !== -1) {
    defMaxPages = 12;
} else if (navigator.userAgent.indexOf('Chrome') !== -1) {
    defMaxPages = 25;
}

const defMaxCanvasHeight = defSheetHeight * defMaxPages;

const font_selector = document.getElementById("font-selector");

let scale = 1.0;
let setContentType = "characters";

let contentType = undefined;
let contentPagesNeeded = 1;
let contentLinesMax = 0;
let content = letters;
let contentI = 0; /* count var of written content chars */
let contentJ = 0; /* count var of written lines */


for (let key in practice_fonts) {
    font_selector.innerHTML += `
<div class="font-box">
    <p class="font-name"><strong>${practice_fonts[key]["name"]}</strong><span class="svg-wrap"><svg onclick="window.open('https://fonts.google.com', '_blank')" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 190 35" width="190" height="35" preserveAspectRatio="xMidYMid meet"><defs><clipPath id="__lottie_element_78"><rect width="190" height="35" x="0" y="0"></rect></clipPath><mask id="__lottie_element_93"><path fill="#ffffff" clip-rule="nonzero" d="M0,0  h190 v35 h-190 v-35  M29.062000274658203,-3 C29.062000274658203,-3 14.753000259399414,-3 14.753000259399414,-3 C14.753000259399414,-3 14.753000259399414,29.816999435424805 14.753000259399414,29.816999435424805 C14.753000259399414,29.816999435424805 29.062000274658203,29.816999435424805 29.062000274658203,29.816999435424805 C29.062000274658203,29.816999435424805 29.062000274658203,-3 29.062000274658203,-3" fill-opacity="1"></path></mask></defs><g clip-path="url(#__lottie_element_78)"><g style="display: block;" transform="matrix(1,0,0,1,127.7509994506836,9.538000106811523)" opacity="0.9999998435623989"><g opacity="1" transform="matrix(1,0,0,1,5.057000160217285,8.484000205993652)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M-2.690999984741211,1.1729999780654907 C-2.690999984741211,1.1729999780654907 -2.690999984741211,8.234000205993652 -2.690999984741211,8.234000205993652 C-2.690999984741211,8.234000205993652 -4.807000160217285,8.234000205993652 -4.807000160217285,8.234000205993652 C-4.807000160217285,8.234000205993652 -4.807000160217285,-8.234000205993652 -4.807000160217285,-8.234000205993652 C-4.807000160217285,-8.234000205993652 4.807000160217285,-8.234000205993652 4.807000160217285,-8.234000205993652 C4.807000160217285,-8.234000205993652 4.807000160217285,-6.210999965667725 4.807000160217285,-6.210999965667725 C4.807000160217285,-6.210999965667725 -2.690999984741211,-6.210999965667725 -2.690999984741211,-6.210999965667725 C-2.690999984741211,-6.210999965667725 -2.690999984741211,-0.8059999942779541 -2.690999984741211,-0.8059999942779541 C-2.690999984741211,-0.8059999942779541 4.072000026702881,-0.8059999942779541 4.072000026702881,-0.8059999942779541 C4.072000026702881,-0.8059999942779541 4.072000026702881,1.1729999780654907 4.072000026702881,1.1729999780654907 C4.072000026702881,1.1729999780654907 -2.690999984741211,1.1729999780654907 -2.690999984741211,1.1729999780654907z"></path></g><g opacity="1" transform="matrix(1,0,0,1,16.618999481201172,11.083000183105469)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M-5.796000003814697,0 C-5.796000003814697,-1.7319999933242798 -5.251999855041504,-3.1659998893737793 -4.163000106811523,-4.301000118255615 C-3.059000015258789,-5.435999870300293 -1.6710000038146973,-6.002999782562256 0,-6.002999782562256 C1.6720000505447388,-6.002999782562256 3.0510001182556152,-5.435999870300293 4.139999866485596,-4.301000118255615 C5.24399995803833,-3.1659998893737793 5.796000003814697,-1.7319999933242798 5.796000003814697,0 C5.796000003814697,1.7480000257492065 5.24399995803833,3.181999921798706 4.139999866485596,4.301000118255615 C3.0510001182556152,5.435999870300293 1.6720000505447388,6.002999782562256 0,6.002999782562256 C-1.6710000038146973,6.002999782562256 -3.059000015258789,5.435999870300293 -4.163000106811523,4.301000118255615 C-5.251999855041504,3.1659998893737793 -5.796000003814697,1.7319999933242798 -5.796000003814697,0z M-3.680000066757202,0 C-3.680000066757202,1.2109999656677246 -3.3269999027252197,2.191999912261963 -2.621999979019165,2.943000078201294 C-1.9170000553131104,3.694999933242798 -1.0429999828338623,4.070000171661377 0,4.070000171661377 C1.0429999828338623,4.070000171661377 1.9170000553131104,3.694999933242798 2.621999979019165,2.943000078201294 C3.3269999027252197,2.191999912261963 3.680000066757202,1.2109999656677246 3.680000066757202,0 C3.680000066757202,-1.1959999799728394 3.3269999027252197,-2.1700000762939453 2.621999979019165,-2.9210000038146973 C1.9010000228881836,-3.687999963760376 1.0269999504089355,-4.071000099182129 0,-4.071000099182129 C-1.027999997138977,-4.071000099182129 -1.9019999504089355,-3.687999963760376 -2.621999979019165,-2.9210000038146973 C-3.3269999027252197,-2.1700000762939453 -3.680000066757202,-1.1959999799728394 -3.680000066757202,0z"></path></g><g opacity="1" transform="matrix(1,0,0,1,29.204999923706055,10.89900016784668)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M-4.991000175476074,-5.451000213623047 C-4.991000175476074,-5.451000213623047 -2.9670000076293945,-5.451000213623047 -2.9670000076293945,-5.451000213623047 C-2.9670000076293945,-5.451000213623047 -2.9670000076293945,-3.888000011444092 -2.9670000076293945,-3.888000011444092 C-2.9670000076293945,-3.888000011444092 -2.875,-3.888000011444092 -2.875,-3.888000011444092 C-2.552999973297119,-4.439000129699707 -2.058000087738037,-4.89900016784668 -1.3910000324249268,-5.267000198364258 C-0.7239999771118164,-5.636000156402588 -0.03099999949336052,-5.818999767303467 0.6909999847412109,-5.818999767303467 C2.071000099182129,-5.818999767303467 3.131999969482422,-5.425000190734863 3.875,-4.635000228881836 C4.61899995803833,-3.8459999561309814 4.991000175476074,-2.7219998836517334 4.991000175476074,-1.2649999856948853 C4.991000175476074,-1.2649999856948853 4.991000175476074,5.818999767303467 4.991000175476074,5.818999767303467 C4.991000175476074,5.818999767303467 2.875,5.818999767303467 2.875,5.818999767303467 C2.875,5.818999767303467 2.875,-1.128000020980835 2.875,-1.128000020980835 C2.8289999961853027,-2.9679999351501465 1.9019999504089355,-3.888000011444092 0.09200000017881393,-3.888000011444092 C-0.7519999742507935,-3.888000011444092 -1.4570000171661377,-3.5460000038146973 -2.0239999294281006,-2.864000082015991 C-2.5920000076293945,-2.180999994277954 -2.875,-1.3650000095367432 -2.875,-0.41499999165534973 C-2.875,-0.41499999165534973 -2.875,5.818999767303467 -2.875,5.818999767303467 C-2.875,5.818999767303467 -4.991000175476074,5.818999767303467 -4.991000175476074,5.818999767303467 C-4.991000175476074,5.818999767303467 -4.991000175476074,-5.451000213623047 -4.991000175476074,-5.451000213623047z"></path></g><g opacity="1" transform="matrix(1,0,0,1,39.07400131225586,9.449999809265137)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M1.6330000162124634,7.452000141143799 C0.7129999995231628,7.452000141143799 -0.050999999046325684,7.168000221252441 -0.656000018119812,6.599999904632568 C-1.2619999647140503,6.0329999923706055 -1.5720000267028809,5.24399995803833 -1.5880000591278076,4.23199987411499 C-1.5880000591278076,4.23199987411499 -1.5880000591278076,-2.069999933242798 -1.5880000591278076,-2.069999933242798 C-1.5880000591278076,-2.069999933242798 -3.565000057220459,-2.069999933242798 -3.565000057220459,-2.069999933242798 C-3.565000057220459,-2.069999933242798 -3.565000057220459,-4.000999927520752 -3.565000057220459,-4.000999927520752 C-3.565000057220459,-4.000999927520752 -1.5880000591278076,-4.000999927520752 -1.5880000591278076,-4.000999927520752 C-1.5880000591278076,-4.000999927520752 -1.5880000591278076,-7.452000141143799 -1.5880000591278076,-7.452000141143799 C-1.5880000591278076,-7.452000141143799 0.5289999842643738,-7.452000141143799 0.5289999842643738,-7.452000141143799 C0.5289999842643738,-7.452000141143799 0.5289999842643738,-4.000999927520752 0.5289999842643738,-4.000999927520752 C0.5289999842643738,-4.000999927520752 3.2880001068115234,-4.000999927520752 3.2880001068115234,-4.000999927520752 C3.2880001068115234,-4.000999927520752 3.2880001068115234,-2.069999933242798 3.2880001068115234,-2.069999933242798 C3.2880001068115234,-2.069999933242798 0.5289999842643738,-2.069999933242798 0.5289999842643738,-2.069999933242798 C0.5289999842643738,-2.069999933242798 0.5289999842643738,3.5420000553131104 0.5289999842643738,3.5420000553131104 C0.5289999842643738,4.293000221252441 0.6740000247955322,4.803999900817871 0.9660000205039978,5.072000026702881 C1.2569999694824219,5.341000080108643 1.5870000123977661,5.4730000495910645 1.9539999961853027,5.4730000495910645 C2.122999906539917,5.4730000495910645 2.2880001068115234,5.454999923706055 2.4489998817443848,5.416999816894531 C2.6110000610351562,5.379000186920166 2.759999990463257,5.328000068664551 2.8980000019073486,5.265999794006348 C2.8980000019073486,5.265999794006348 3.565000057220459,7.1519999504089355 3.565000057220459,7.1519999504089355 C3.013000011444092,7.35099983215332 2.368000030517578,7.452000141143799 1.6330000162124634,7.452000141143799z"></path></g><g opacity="1" transform="matrix(1,0,0,1,48.07099914550781,11.083000183105469)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M4.681000232696533,2.506999969482422 C4.681000232696533,3.48799991607666 4.250999927520752,4.316999912261963 3.3929998874664307,4.991000175476074 C2.5339999198913574,5.664999961853027 1.4520000219345093,6.002999782562256 0.15000000596046448,6.002999782562256 C-0.9850000143051147,6.002999782562256 -1.9830000400543213,5.706999778747559 -2.8410000801086426,5.117000102996826 C-3.700000047683716,4.5279998779296875 -4.313000202178955,3.749000072479248 -4.681000232696533,2.7829999923706055 C-4.681000232696533,2.7829999923706055 -2.7960000038146973,1.9780000448226929 -2.7960000038146973,1.9780000448226929 C-2.5190000534057617,2.6530001163482666 -2.117000102996826,3.177999973297119 -1.5880000591278076,3.553999900817871 C-1.059000015258789,3.928999900817871 -0.4790000021457672,4.117000102996826 0.15000000596046448,4.117000102996826 C0.824999988079071,4.117000102996826 1.3880000114440918,3.9719998836517334 1.840000033378601,3.680000066757202 C2.2920000553131104,3.3889999389648438 2.5179998874664307,3.0439999103546143 2.5179998874664307,2.6449999809265137 C2.5179998874664307,1.9240000247955322 1.9670000076293945,1.3960000276565552 0.8629999756813049,1.0579999685287476 C0.8629999756813049,1.0579999685287476 -1.0700000524520874,0.574999988079071 -1.0700000524520874,0.574999988079071 C-3.263000011444092,0.023000000044703484 -4.359000205993652,-1.034999966621399 -4.359000205993652,-2.5989999771118164 C-4.359000205993652,-3.625999927520752 -3.941999912261963,-4.451000213623047 -3.1059999465942383,-5.071000099182129 C-2.2699999809265137,-5.691999912261963 -1.2000000476837158,-6.002999782562256 0.10400000214576721,-6.002999782562256 C1.100000023841858,-6.002999782562256 2.000999927520752,-5.764999866485596 2.805999994277954,-5.289999961853027 C3.6110000610351562,-4.814000129699707 4.173999786376953,-4.178999900817871 4.494999885559082,-3.38100004196167 C4.494999885559082,-3.38100004196167 2.609999895095825,-2.5989999771118164 2.609999895095825,-2.5989999771118164 C2.3949999809265137,-3.0739998817443848 2.046999931335449,-3.446000099182129 1.5640000104904175,-3.7149999141693115 C1.0809999704360962,-3.9820001125335693 0.5389999747276306,-4.117000102996826 -0.057999998331069946,-4.117000102996826 C-0.6100000143051147,-4.117000102996826 -1.1050000190734863,-3.9790000915527344 -1.5420000553131104,-3.703000068664551 C-1.9789999723434448,-3.427000045776367 -2.197000026702881,-3.0899999141693115 -2.197000026702881,-2.690999984741211 C-2.197000026702881,-2.046999931335449 -1.590999960899353,-1.5870000123977661 -0.38100001215934753,-1.3109999895095825 C-0.38100001215934753,-1.3109999895095825 1.3229999542236328,-0.8740000128746033 1.3229999542236328,-0.8740000128746033 C3.561000108718872,-0.32199999690055847 4.681000232696533,0.8050000071525574 4.681000232696533,2.506999969482422z"></path></g></g><g style="display: block;" transform="matrix(1,0,0,1,45.75,7.75)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,9.361000061035156,9.559000015258789)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M0.37599998712539673,9.309000015258789 C-4.7769999504089355,9.309000015258789 -9.111000061035156,5.131999969482422 -9.111000061035156,0 C-9.111000061035156,-5.13100004196167 -4.7769999504089355,-9.309000015258789 0.37599998712539673,-9.309000015258789 C3.2279999256134033,-9.309000015258789 5.256999969482422,-8.196000099182129 6.785999774932861,-6.743000030517578 C6.785999774932861,-6.743000030517578 4.98199987411499,-4.949999809265137 4.98199987411499,-4.949999809265137 C3.888000011444092,-5.9710001945495605 2.4059998989105225,-6.765999794006348 0.37599998712539673,-6.765999794006348 C-3.38700008392334,-6.765999794006348 -6.328999996185303,-3.746000051498413 -6.328999996185303,0 C-6.328999996185303,3.746999979019165 -3.38700008392334,6.767000198364258 0.37599998712539673,6.767000198364258 C2.815999984741211,6.767000198364258 4.208000183105469,5.789999961853027 5.0980000495910645,4.90500020980835 C5.827000141143799,4.177999973297119 6.307000160217285,3.134000062942505 6.48799991607666,1.7029999494552612 C6.48799991607666,1.7029999494552612 0.37599998712539673,1.7029999494552612 0.37599998712539673,1.7029999494552612 C0.37599998712539673,1.7029999494552612 0.37599998712539673,-0.8399999737739563 0.37599998712539673,-0.8399999737739563 C0.37599998712539673,-0.8399999737739563 8.975000381469727,-0.8399999737739563 8.975000381469727,-0.8399999737739563 C9.065999984741211,-0.38600000739097595 9.111000061035156,0.1599999964237213 9.111000061035156,0.75 C9.111000061035156,2.6570000648498535 8.586000442504883,5.01800012588501 6.8979997634887695,6.698999881744385 C5.25600004196167,8.401000022888184 3.1589999198913574,9.309000015258789 0.37599998712539673,9.309000015258789z"></path></g><g opacity="1" transform="matrix(1,0,0,1,25.83799934387207,12.87399959564209)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M5.934999942779541,0 C5.934999942779541,3.4509999752044678 3.2690000534057617,5.99399995803833 -0.0010000000474974513,5.99399995803833 C-3.2699999809265137,5.99399995803833 -5.934999942779541,3.4509999752044678 -5.934999942779541,0 C-5.934999942779541,-3.4739999771118164 -3.2699999809265137,-5.99399995803833 -0.0010000000474974513,-5.99399995803833 C3.2690000534057617,-5.99399995803833 5.934999942779541,-3.4739999771118164 5.934999942779541,0z M3.3369998931884766,0 C3.3369998931884766,-2.1570000648498535 1.7899999618530273,-3.632999897003174 -0.0010000000474974513,-3.632999897003174 C-1.7920000553131104,-3.632999897003174 -3.3380000591278076,-2.1570000648498535 -3.3380000591278076,0 C-3.3380000591278076,2.134000062942505 -1.7920000553131104,3.632999897003174 -0.0010000000474974513,3.632999897003174 C1.7899999618530273,3.632999897003174 3.3369998931884766,2.134000062942505 3.3369998931884766,0z"></path></g><g opacity="1" transform="matrix(1,0,0,1,39.14099884033203,12.87399959564209)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M5.934999942779541,0 C5.934999942779541,3.4509999752044678 3.2690000534057617,5.99399995803833 -0.0010000000474974513,5.99399995803833 C-3.2690000534057617,5.99399995803833 -5.934999942779541,3.4509999752044678 -5.934999942779541,0 C-5.934999942779541,-3.4739999771118164 -3.2690000534057617,-5.99399995803833 -0.0010000000474974513,-5.99399995803833 C3.2690000534057617,-5.99399995803833 5.934999942779541,-3.4739999771118164 5.934999942779541,0z M3.3369998931884766,0 C3.3369998931884766,-2.1570000648498535 1.7910000085830688,-3.632999897003174 -0.0010000000474974513,-3.632999897003174 C-1.7920000553131104,-3.632999897003174 -3.3369998931884766,-2.1570000648498535 -3.3369998931884766,0 C-3.3369998931884766,2.134000062942505 -1.7920000553131104,3.632999897003174 -0.0010000000474974513,3.632999897003174 C1.7910000085830688,3.632999897003174 3.3369998931884766,2.134000062942505 3.3369998931884766,0z"></path></g><g opacity="1" transform="matrix(1,0,0,1,52.275001525878906,15.5649995803833)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M5.769999980926514,-8.321999549865723 C5.769999980926514,-8.321999549865723 5.769999980926514,2.440999984741211 5.769999980926514,2.440999984741211 C5.769999980926514,6.86899995803833 3.1480000019073486,8.6850004196167 0.04600000008940697,8.6850004196167 C-2.872999906539917,8.6850004196167 -4.629000186920166,6.73199987411499 -5.289999961853027,5.14300012588501 C-5.289999961853027,5.14300012588501 -2.98799991607666,4.189000129699707 -2.98799991607666,4.189000129699707 C-2.5769999027252197,5.164999961853027 -1.5740000009536743,6.322999954223633 0.04600000008940697,6.322999954223633 C2.0299999713897705,6.322999954223633 3.26200008392334,5.0980000495910645 3.26200008392334,2.803999900817871 C3.26200008392334,2.803999900817871 3.26200008392334,1.940999984741211 3.26200008392334,1.940999984741211 C3.26200008392334,1.940999984741211 3.1710000038146973,1.940999984741211 3.1710000038146973,1.940999984741211 C2.578000068664551,2.6679999828338623 1.437000036239624,3.302999973297119 0.0010000000474974513,3.302999973297119 C-3.009999990463257,3.302999973297119 -5.769999980926514,0.6930000185966492 -5.769999980926514,-2.6679999828338623 C-5.769999980926514,-6.051000118255615 -3.009999990463257,-8.6850004196167 0.0010000000474974513,-8.6850004196167 C1.437000036239624,-8.6850004196167 2.578000068664551,-8.048999786376953 3.1710000038146973,-7.34499979019165 C3.1710000038146973,-7.34499979019165 3.26200008392334,-7.34499979019165 3.26200008392334,-7.34499979019165 C3.26200008392334,-7.34499979019165 3.26200008392334,-8.321999549865723 3.26200008392334,-8.321999549865723 C3.26200008392334,-8.321999549865723 5.769999980926514,-8.321999549865723 5.769999980926514,-8.321999549865723z M3.444000005722046,-2.6679999828338623 C3.444000005722046,-4.7789998054504395 2.0299999713897705,-6.323999881744385 0.2290000021457672,-6.323999881744385 C-1.5959999561309814,-6.323999881744385 -3.124000072479248,-4.7789998054504395 -3.124000072479248,-2.6679999828338623 C-3.124000072479248,-0.5789999961853027 -1.5959999561309814,0.9419999718666077 0.2290000021457672,0.9419999718666077 C2.0299999713897705,0.9419999718666077 3.444000005722046,-0.5789999961853027 3.444000005722046,-2.6679999828338623z"></path></g><g opacity="1" transform="matrix(1,0,0,1,61.36000061035156,9.694999694824219)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M1.3229999542236328,8.809000015258789 C1.3229999542236328,8.809000015258789 -1.3229999542236328,8.809000015258789 -1.3229999542236328,8.809000015258789 C-1.3229999542236328,8.809000015258789 -1.3229999542236328,-8.809000015258789 -1.3229999542236328,-8.809000015258789 C-1.3229999542236328,-8.809000015258789 1.3229999542236328,-8.809000015258789 1.3229999542236328,-8.809000015258789 C1.3229999542236328,-8.809000015258789 1.3229999542236328,8.809000015258789 1.3229999542236328,8.809000015258789z"></path></g><g opacity="1" transform="matrix(1,0,0,1,69.73799896240234,12.87399959564209)"><path fill="rgb(95,99,104)" fill-opacity="1" d=" M3.3440001010894775,1.975000023841858 C3.3440001010894775,1.975000023841858 5.396999835968018,3.3369998931884766 5.396999835968018,3.3369998931884766 C4.736999988555908,4.314000129699707 3.1389999389648438,5.993000030517578 0.3799999952316284,5.993000030517578 C-3.0399999618530273,5.993000030517578 -5.511000156402588,3.3610000610351562 -5.511000156402588,0.0010000000474974513 C-5.511000156402588,-3.563999891281128 -3.0190000534057617,-5.993000030517578 0.08399999886751175,-5.993000030517578 C3.2090001106262207,-5.993000030517578 4.736999988555908,-3.5190000534057617 5.23799991607666,-2.180000066757202 C5.23799991607666,-2.180000066757202 5.511000156402588,-1.4989999532699585 5.511000156402588,-1.4989999532699585 C5.511000156402588,-1.4989999532699585 -2.5390000343322754,1.815999984741211 -2.5390000343322754,1.815999984741211 C-1.9229999780654907,3.0190000534057617 -0.9660000205039978,3.632999897003174 0.3799999952316284,3.632999897003174 C1.725000023841858,3.632999897003174 2.6610000133514404,2.9739999771118164 3.3440001010894775,1.975000023841858z M-2.9730000495910645,-0.18199999630451202 C-2.9730000495910645,-0.18199999630451202 2.4100000858306885,-2.4059998989105225 2.4100000858306885,-2.4059998989105225 C2.11299991607666,-3.1549999713897705 1.2239999771118164,-3.677999973297119 0.17399999499320984,-3.677999973297119 C-1.1710000038146973,-3.677999973297119 -3.0399999618530273,-2.497999906539917 -2.9730000495910645,-0.18199999630451202z"></path></g></g><g mask="url(#__lottie_element_93)" style="display: block;" transform="matrix(1,0,0,1,1.25,5.75)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,12,11.75)"><path fill="rgb(251,188,4)" fill-opacity="1" d=" M-11.75,11.5 C-11.75,11.5 2.75,-11.5 2.75,-11.5 C2.75,-11.5 11.75,-11.5 11.75,-11.5 C11.75,-11.5 11.75,-8.300000190734863 11.75,-8.300000190734863 C11.75,-8.300000190734863 -0.75,11.5 -0.75,11.5"></path></g></g><g style="display: block;" transform="matrix(1,0,0,1,15.75,5.75)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,4.75,11.75)"><path fill="rgb(26,115,232)" fill-opacity="1" d=" M4.5,11.5 C4.5,11.5 -4.5,11.5 -4.5,11.5 C-4.5,11.5 -4.5,-11.5 -4.5,-11.5 C-4.5,-11.5 4.5,-11.5 4.5,-11.5 C4.5,-11.5 4.5,11.5 4.5,11.5z"></path></g></g><g style="display: block;" transform="matrix(0.9999918341636658,0,0,0.9999918341636658,24.75,15.750055313110352)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,3.5,6.75)"><path fill="rgb(52,168,83)" fill-opacity="1" d=" M3.25,0 C3.25,3.5899999141693115 0.3400000035762787,6.5 -3.25,6.5 C-3.25,6.5 -3.25,-6.5 -3.25,-6.5 C0.3400000035762787,-6.5 3.25,-3.5899999141693115 3.25,0z"></path></g></g><g style="display: block;" transform="matrix(0.9999918341636658,0,0,0.9999918341636658,18.25005340576172,15.750055313110352)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,3.5,6.75)"><path fill="rgb(13,101,45)" fill-opacity="1" d=" M3.25,6.5 C-0.3400000035762787,6.5 -3.25,3.5899999141693115 -3.25,0 C-3.25,-3.5899999141693115 -0.3400000035762787,-6.5 3.25,-6.5 C3.25,-6.5 3.25,6.5 3.25,6.5z"></path></g></g><g style="display: block;" transform="matrix(1,0,0,1,24.75,5.75)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,2.75,5.25)"><path fill="rgb(26,115,232)" fill-opacity="1" d=" M2.5,0 C2.5,2.760999917984009 0.2619999945163727,5 -2.5,5 C-2.5,5 -2.5,-5 -2.5,-5 C0.2619999945163727,-5 2.5,-2.760999917984009 2.5,0z"></path></g></g><g style="display: block;" transform="matrix(1,0,0,1,19.75,5.75)" opacity="1"><g opacity="1" transform="matrix(1,0,0,1,2.75,5.25)"><path fill="rgb(23,78,166)" fill-opacity="1" d=" M2.5,5 C-0.2619999945163727,5 -2.5,2.760999917984009 -2.5,0 C-2.5,-2.760999917984009 -0.2619999945163727,-5 2.5,-5 C2.5,-5 2.5,5 2.5,5z"></path></g></g><g style="display: block;" transform="matrix(1,0,0,1,1.75,5.75)" opacity="0.9999998998719073"><g opacity="1" transform="matrix(1,0,0,1,4.75,4.75)"><path fill="rgb(234,67,53)" fill-opacity="1" d=" M-4.5,0 C-4.5,-2.484999895095825 -2.484999895095825,-4.5 0,-4.5 C2.484999895095825,-4.5 4.5,-2.484999895095825 4.5,0 C4.5,2.484999895095825 2.484999895095825,4.5 0,4.5 C-2.484999895095825,4.5 -4.5,2.484999895095825 -4.5,0z"></path></g></g></g></svg></span></p>
    <hp class="font-preview" style="font-family: ${practice_fonts[key]["name"]};">Alle Menschen sind frei und gleich an Würde und Rechten geboren.</hp>
    <button style="justify-self: right" onclick="selectFont('${practice_fonts[key]["name"]}')">Select Font</button>
    </div>`;
};

let currentFont = undefined;
let sheetType = undefined;

function getTextWidth(text, font) {
    const canvas = document.createElement("canvas");
    const context = canvas.getContext("2d");
    context.font = font;
    const metrics = context.measureText(text);
    return metrics.width;
}

async function reloadContent(atend = false) {
    contentI = 0;

    if (atend) {
        contentType = undefined;
        return;
    }

    switch (contentType) {
        case "characters":
            content = letters;
            break;
        case "numbers":
            content = numbers;
            break;
        case "random":
            content = await fetchRandomText();
            break;
    }
}

async function createLine(fontname) {
    let line = document.createElement("span");

    if (contentType != undefined) {

        let lineState = "";
        let lineText = "";
        let word;

        while (getTextWidth(lineText, `${practice_fonts[fontname]["font_size"] * scale}px ${fontname}`) <= defMaxTextWidth) {
            //console.log("width: " + line.offsetWidth)
            //console.log(line.innerHTML);
            word = "";

            for (; contentI < content.length; contentI++) {
                if (content[contentI] != " ")
                    word += content[contentI];
                else {
                    contentI++;
                    lineText += " ";
                    break;
                }
            }

            lineState = lineText;

            if (word == "<br>") {
                word = "";
                break;
            }

            if (contentI == content.length) {
                lineText += " " + word;
                if (getTextWidth(lineText, `${practice_fonts[fontname]["font_size"] * scale}px ${fontname}`) <= defMaxTextWidth) {
                    lineState = lineText;
                    await reloadContent(true);
                }
                break;
            }
            lineText += word;
        }

        if (contentI != 0) {
            contentI -= (word.length + 1);
            if (contentJ == contentLinesMax - 1)
                contentPagesNeeded++;
        }

        line.innerHTML = lineState;

    }

    line.classList.add("writing-exercise-line");
    if(sheetType == "multilined") {
        line.classList.add("multi-lined");
        line.style.setProperty('--after-top-margin', `${practice_fonts[fontname]["center_line_top_margin"] * scale}px`);
        line.style.setProperty('--after-border-width', `${defLineBorderWidth * scale}px`);
    }
    line.classList.add(fontname);

    line.style.height = `${defLineHeight * scale}px`
    line.style.fontSize = `${practice_fonts[fontname]["font_size"] * scale}px`;
    line.style.lineHeight = `${practice_fonts[fontname]["line_height"] * scale}px`;
    line.style.borderWidth = `${(defLineBorderWidth * scale)}px`;

    return line;
}

function createLegalSection() {
    let line = document.createElement("span");
    line.innerHTML = `All license fees have been fully settled. 
    Personal and Comercial use in any form are only permitted up to and including ${new Date().toISOString().split('T')[0]}.<br>© 2024 Noah Nagel`
    line.classList.add("legal-section");
    line.id = "legal-section";
    return line;
}

async function createSheet() {
    let sheet = document.createElement("div");
    sheet.style.maxHeight = `${defMaxCanvasHeight}px`;
    sheet.id = "preview-sheet";

    contentType = setContentType;
    contentPagesNeeded = 1;

    await reloadContent();

    contentLinesMax = Math.floor(defLineAmount / scale);

    for (let i = 0; i < contentPagesNeeded; i++) {
        if (i == defMaxPages)
            break;
        sheet.classList.add("writing-exercise-sheet");
        //sheet.style.fontFamily = name;
        for (contentJ = 0; contentJ < contentLinesMax; contentJ++)
            sheet.appendChild(await createLine(currentFont));
        sheet.appendChild(createLegalSection());
    }

    sheet.style.height = `${defSheetHeight * contentPagesNeeded}px`

    return sheet;
}

async function selectFont(name) {
    currentFont = name;

    sheetType = "primary";

    sheet = await createSheet();

    let preview = document.createElement("div");
    preview.classList.add("pdf-preview-container");
    preview.id = "pdf-preview-container";

    let preview_wrap = document.createElement("div");
    preview_wrap.classList.add("pdf-preview-container-wrap");
    preview.appendChild(sheet);
    preview_wrap.innerHTML += `<div class="input-section">
           <div class="input-wrap">
           <label for="text">Content</label>
    <select id="text" onchange="changeContent()">
              <option value="characters">Characters</option>
                            <option value="numbers">Digits</option>
          <option value="random">Random Kafka Text</option>
        </select>
        </div><div class="input-wrap">
                   <label for="background">Sheet Type</label>
    <select id="background" onchange="changeSheetType()">
          <option value="primary">One-Lined Paper</option>
          <option value="multilined">Multi-Lined Paper </option>
        </select>
        </div>
        <div class="input-wrap">
        <label for="speed">Scale</label>
        <input type="range" onchange="changeScale()" min="0.6" max="2" value="${scale}" step="0.1" class="slider" id="scale">
        </div>
        </div>`;
    preview_wrap.appendChild(preview);
    preview_wrap.innerHTML += `<button onclick="cancel()">Cancel</button><button onclick="save('${name}')" id="saveButton">Save</button>`


    let preview_blur = document.createElement("div");
    preview_blur.classList.add("pdf-preview-container-blur");
    preview_blur.appendChild(preview_wrap);

    currentOverlay = preview_blur;

    document.body.style.overflowY = "hidden";
    document.body.appendChild(preview_blur);

    document.getElementById("text").value = setContentType;
}

async function rerender() {
    document.getElementById("preview-sheet").remove();

    document.getElementById("pdf-preview-container").appendChild(await createSheet()); /* create new sheet */
}

async function changeScale() {
    console.log("Setting scale to " + document.getElementById("scale").value);
    scale = document.getElementById("scale").value;

    await rerender();
}

async function fetchRandomText() {
    try {
        const response = await fetch("{{ '/assets/json/kafka.json' | relative_url }}");
        if (!response.ok) {
            throw new Error('response not ok ' + response.statusText);
        }
        const data = await response.json();

        const keys = Object.keys(data);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        return data[randomKey];

    } catch (error) {
        console.error('error fetching json:', error);
    }
}

async function changeContent() {
    console.log("change content");

    setContentType = document.getElementById("text").value;
    contentType = setContentType;

    console.log("contentType: " + contentType);

    await rerender();
}

async function changeSheetType() {
    sheetType = document.getElementById("background").value;
    
    await rerender();
}

function cancel() {
    document.body.style.overflowY = "scroll";
    currentOverlay.remove();
}

function save(name) {
    /* the line height isnt adapted properly so we have to modify it a bit to be in the pdf as previewed */
    let downscaleFactor = 20;

    document.querySelectorAll(".writing-exercise-line ").forEach(element => {
        const currentLineHeight = parseInt(window.getComputedStyle(element).lineHeight);

        element.style.lineHeight = `${(currentLineHeight + practice_fonts[name]["line_height_correction"] * scale)}px`;
        element.style.height = `${(defLineHeight * scale)}px`
        element.style.fontSize = `${(practice_fonts[name]["font_size"] * scale)}px`;
    });


    let print = document.createElement("div");
    print.classList.add("pdf-preview-container");
    print.classList.add("print");
    print.innerHTML = document.getElementById("pdf-preview-container").innerHTML;

    print.style.width =


        document.getElementById("saveButton").innerHTML = `Generating...`

    height = defSheetHeight * contentPagesNeeded;

    if (height > defMaxCanvasHeight)
        height = defMaxCanvasHeight;

    html2pdf().set({
        margin: 0,
        filename: 'document.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 3, width: (defSheetWidth), height: (height), windowWidth: document.body.offsetWidth, scrollY: 0 },
        jsPDF: { unit: 'px', format: [defSheetWidth, defSheetHeight] } // Custom size with exact dimensions
    }).from(print).save().then(() => {
        document.body.style.overflowY = "scroll";
        currentOverlay.remove();
    });
}